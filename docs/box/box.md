## I. Назначение

Что же такое **WEGABOX**?

WEGABOX это отдельное устройство и элемент экосистемы WEGA, по сбору и управлению параметрами гидропонной установки. В первую очередь он разработан для применения с замкнутыми гидропонными системами (далее система) такими как **DNFT**, **NFT**, **Dutch Bucket** и аналогичными системами, WEGABOX <u>**НЕ ПОДХОДИТ**</u> для систем капельного полива, так как в данных системах возможно использование только малой части его функционала. 

WEGABOX позволяет получать и контролировать следующие параметры системы:

1.Микроклимат:

    1.1. Температура и влажность воздуха;
    1.2. Освещенность;
    1.3. Атмосферное давление;
    1.4. Концентрация содержания CO2 в воздухе.
2.Раствор:

    2.1. EC раствора;
    2.2. Температура раствора в баке;
    2.3. PH раствора;
    2.4. Температура раствора в корневой зоне растений;
    2.5. Объем раствора в баке.
3.Расчетные параметры:

    3.1. Расход солей в сутки;
    3.2. Изменение каждого параметра в сутки;
    3.3. Построение графиков;
    3.4. Отображение параметров раствора на миниатюрном экране.

**WEGABOX** не полностью самостоятельное устройство, он работает только в связке с **WEGA-Server**, передает данные на него и получает в ответ калибровочные значения для датчиков, которые позволяют ему в случае отсутствия связи с сервером работать автономно.

Вывод информации с датчиков осуществляется в WEB интерфейсе (Рисунок 1) на который можно зайти по IP адресу Вегабокса, на сервере (Рисунок 2) а также на компактном LCD экране (Рисунок 3), который подключается по  шине i2c, экран можно установить как рядом с Wegabox так и в любом удобном месте.

**<Вставить ссылку на рисунок>**

Рисунок 1. WEB интерфейс WEGABOX

**<Вставить ссылку на рисунок>**

Рисунок 2. WEGA-Server

**<Вставить ссылку на рисунок>**

Рисунок 3. LCD экран

Помимо сбора данных с датчиков и их обработки WEGABOX может выполнять функции контроля и управления системой:
- Отключение/включение помпы при превышении температуры раствора над температурой окружающего воздуха, чтобы исключить появления эффекта растрескавшихся стволов растений из-за изменений корневого давления;
- Поддержания заданного уровня EC раствора путем долива чистой/дистиллированной/осмосной воды в бак с раствором;
- Долив концентратов А и Б в раствор для пополнения съеденных растением солей (**данная функция на текущем этапе находится на этапе тестирования и обкатки**);
- Управление освещением гидропонной установки по таймеру (**функционал, заложенный в WEGABOX в качестве развития, сейчас он еще не реализован**);
- Возможность видео и фото фиксации роста растений с привязкой данных от датчиков (**функционал, заложенный в WEGABOX в качестве развития, сейчас он еще не реализован**);
- Управление другими исполнительными устройствами по заданным алгоритмам
- Можете предложить свои варианты в разделе чата посвященному экосистеме **WEGA** – [**«Фонтан идей»**](https://t.me/WEGA_SERVER/20895).

Важно понимать, **WEGABOX**, как и вся экосистема WEGA не вырастит за вас растение, как волшебное средство, он позволит взять на себя рутинную работу по измерению параметров и ведению статистики, позволит избежать и предотвратить ошибки с раствором, возьмёт на себя часть функций по управлению, но в первую очередь это современный инструмент, для гидропоники который нужно знать и правильно им пользоваться. 

## II. Датчики
Датчики в Wegabox могут быть самодельными (EC, PR), полупромышленными (AHT10/20, US-025, SDS-30) и полностью промышленными (DS18B20), но независимо от способа их изготовления на каждый датчик нужно припаять штекер Jack 3.5 мм на 4 контакта (4 pin). Ниже представлено описание каждого датчика его назначение, и варианты исполнения. 

**1.Датчик температуры и влажности воздуха** - Служит для измерения параметров окружающего воздуха, данные передаются в Wegabox по шине i2c. Не требует калибровки, после включения сразу начинает передавать данные на сервер. На Рисунке 4 показан один из вариантов датчика на базе модуля AHT10. В качестве датчика могут использоваться следующие устройства:

**1.1. AHT10** – цифровой датчик, измеряет температуру в диапазоне -40 ÷ +850C с точностью ±0,30C, влажность 0% ÷ 100%±2%. Для датчика разработана 3D модель корпуса, которую можно скачать по ссылке - **<Ссылка на 3D модель корпуса>** и распечатать на 3D принтере;

**1.2. AHT20** – аналогичный AHT10 датчик, но более стабильно работающий на шине i2c. Корпус для датчика используется такой же как и для **AHT10**;

**1.3. SDC30** – это датчик концентрации СО2 в воздухе (более подробно о нем ниже), но он также измеряет температуру и влажность воздуха, что позволяет два датчика заменить одним не увеличивая количество разъемов на WEGABOX. Для датчика разработана 3D модель корпуса, которую можно скачать по ссылке - **<Ссылка на 3D модель корпуса>** и распечатать на 3D принтере. 

**<Вставить ссылку на рисунок>**

Рисунок 4. Датчик температуры и влажности воздуха

**2.Датчик температуры в зоне корней** - это герметичный датчик который показывает температуру раствора гидропонной системы непосредственно в корневой зоне, помимо основного назначение, данный датчик служит для калибровки терморезистора EC датчика. Не требует калибровки и после включения сразу начинает передавать данные на сервер. Данные в Wegabox передаются по шине 1-wire, В качестве датчка используется промышленный датчик DS18B20 установленный в металлическую гильзу и залитый компаундом. Внешний вид датчика показан на Рисунке 5.

**<Вставить ссылку на рисунок>**

Рисунок 5. Датчик температуры раствора в зоне корней

**3.Датчик EC раствора (кондуктометр)** - датчик позволяет определять соленость раствора в мсм/см2 с учетом температуры раствора, для этого в его конструкции предусмотрен терморезистор на 100 кОм, датчик является аналоговым и требует калировки, калибровка проводится в 2 этапа - смотри раздел **<Калибровка EC Датчика>**. В процессе работы каблибровку датчика нужно переодически проверять (штатно 1 раз в 2-3 месяца). Датчик является самодельным, для его изготволения потребуются электроды из нержавеющей стали (в качестве элеткродов можно использовать иглы от медицинского шприца 5-10 мл), терморезистор марки NTC 3950 на 100 кОм, четырех проводный кабель сечением 0,35-0,5 мм2, корпус напечатанный на 3D принтере (3D модельку корпуса можно скачать вот здесь - **<Ссылка на 3D модель корпуса>**) и штекер Jack 3.5 мм на 4 контакта (4 pin). Для упрощения работ можно использовать заводской кабель с штекером от удлинителя наушников обрезав его с одной стороны. Технологию изготовления датчика EC можно посмотреть в Мастерской - **<Ссылка на изготовление EC датчика >**. На рисунке 6 показаны различные варианты исполнения EC датчика. В последнее время на Алиэкспрессе появились ЕС датчики заводского исполнения **<Ссылка на лот>**, основные их особенности в том что у них короткий кабель (не более 0,5-1,0 м) и терморезистор используется на 10 кОм, что потребует замены в Wegabox ответного резистора со 100 кОм на 10 кОм.

**<Вставить ссылку на рисунок>**

Рисунок 6. Датчик EC раствора

**4.Датчик PH раствора** - предназначен для определения показателя PH раствора, устанавливается в бак с раствором. Данный датчик является полностью заводским, его не нужно дорабатывать или припаивать к нему штекер, готов к использованию из коробки. Датчик является аналоговым и требует калибровки, процесс калибровки расписан в разделе настройки WEGA SERVER - смотри раздел **<Калибровка PH Датчика>**. Внешний вид датчика пока рисунке 7.

**<Вставить ссылку на рисунок>**

Рисунок 7. Датчик PH раствора

**5.Датчик уровня раствора в баке** - служит для определения остатка раствора в баке в гидропонной системе. Устанавливается на бак, показывает расстояние в см от датчика до уровня раствора. В зависимости от типа датчика устанавливаются либа сразу в бак (US-025) либо в трубу (лазерный датчик).  Независимо от типа датчика ему требуется калибровка, процесс калибровки расписан в разделе настройки WEGA SERVER - смотри раздел **<Калибровка Датчика уровня раствора>**. В качестве датчика могут использоваться следующие устройства:

**5.1. Ультразвуковой датчик US-025 (или аналогичный по характеристикам)** - является аналогово-цифровым и подключается к своему разъему в Вегабоксе по интерфейсу GPIO, работает на принцепе отражения ультразвуковой волны от поверхности раствора. Питание датчика +3В - +5В. Пределы измерений от 5 см до 300 см, погрешность измерений +- 4 мм, из за этого данный датчк не рекомендуется использовать в широких и низких баках. По опыту эксплуатации, ультразвуковой модуль US-025 стабильние работает в баках прямоугольной конструкции с минимальными скруглениями в углах, в более округлых баках датчик тоже будет работать, но возможны выбросы показаний, из за чего придется при настройке загрублять его показания что отразиться на точности измерений. Датчик устанавливается в корпус, 3D модель корпуса можно скачать вот тут **<Ссылка на 3D модель корпуса US-025>**. Внешний вид датчика показан на рисунке 8.

**<Вставить ссылку на рисунок>**

Рисунок 8. Внешний вид датчика US-025 в корпусе и без

**5.2. Лазерный датчик VL6180X/VL53L0X/VL53L1X** - является аналогово-цифровым и подключается к тому же разъему в Вегабоксе что и US-025 по интерфейсу i2c либо через разветвитель в разъем i2c (датчик AHT10).  Датчик работает на принципе отражения лазерного луча от поплавка, который помещен в вертикальную трубу. Питание датчика +3В - +5В. Рабочие пределы измерений: VL6180X - 2...50 см; VL53L0X - 2...200 см; VL53L1X - 2...400 см. Погрешность измерений +-1 мм. Для установки датчика требуется поместить его в вертикальную чернтую трубу диаметром 40 мм, в качестве отражателя используется напечатанный на 3D принтере полавок, для стабильной работы на верхнюю поверхность нужно наклеить отражатель изготовленный из CD диска, также для исключения залипания, в попловок нужно установить грузик. При печати трубы на 3D принтере, нужно печатать её в режиме вазы в 1 слой по спирали (данные настройки задаются в слайсере 3D печати). 3D модели корпуса датчика, трубы и поплавка можно скачать вот тут **<Ссылка на 3D модель деталей лазерного датчика>**. Внешний вид датчика показан на рисунке 9.  

**<Вставить ссылку на рисунок>**

Рисунок 9. Внешний вид лазерного датчика

**6.Датчик освещенности PR** - Прелназначен для определения освещенности. Датчик является аналоговым и подключается к своему разъему в Вегабоксе. После подключения к Вегабоксу требует калибровки - смотри раздел **<Калибровка Датчика освещенности>**, после калибровки значения отображаются в Люксах/кЛюксах. Пределы измерения от 0,1 Лк до 200 кЛк. Датчик является полностью самодельным и состоит из фоторезистора марки GL5528, корпуса, в качестве корпуса может быть использован колпачек от медицинской иглы или другого подходящего по размерам, двухпроводного кабеля с сечением не меее 0,35 кв.мм и и штекера Jack 3.5 мм на 4 контакта (4 pin). После установки фоторезистора в корпус, его желательно залить прозраной эпоксидной смолой. Один из вариантов исполнения датчка освещенности показан на рисунке 10.

**<Вставить ссылку на рисунок>**

Рисунок 10. Внешний вид датчика освещенности

**7.Датчик концентрации СО2 в воздухе** - предназначен для определения концентрации двуокиси углерода в воздухе (СО2). Датчик построен на базе заводского цифрового NDR модуля SCD30. Для его сборки потребуется напечатанный на 3D принтере корпус (3D модельку корпуса можно скачать вот здесь - **<Ссылка на 3D модель корпуса>**), четырех проводный кабель сечением 0,35-0,5 мм2 и штекер Jack 3.5 мм на 4 контакта (4 pin). Подключение датчика выполняется по интерфейсу i2c, датчик подключается в тот же разъем что и датчик температуры и влажности воздуха. Датчик цифровой, отаклиброван на заводе и начинает отдавать данные уже после подключения его к Вегабоксу. Помимо концентарции СО2 датчик замеряет температуру и влажность воздуха, тем самым сочетая в себе сразу два датчика. Данные концентрации СО2 отображаются в PPM (миллионных долях содержания СО2 в воздухе), пределы измерений: CO2 от 0 до 10 000 PPM, погрешность измерений +- 30 PPM; температура воздуха от -40 до + 120 градусов Цельция, погрешность измерений +- 0,5 градуса; влажность воздуха от 0 до 100%, погрешность измерений +-2%. Внешний вид датчика показан на рисунке 11. 

**<Вставить ссылку на рисунок>**

Рисунок 11. Внешний вид датчика CO2   

**8.Датчик атмосферного давления** - Раздел находиться в разработке

Все датчики за исключением PH электрода идут без разъема, часть датчиков как например DS18B20 идут со своими кабелями. Соответственно на датчики нужно припаять кабели, самый распространненый и недорогой вариант кабеля - КСПВ 4х0,4 (для датчика освещенности PR можно использовать кабель марки КСПВ 2х0,4), а также припаять штекеры Jack 3,5 на 4 контакта (4 pin). Схемы распайки дачиков представлены на Рисунке 12.

**<Вставить ссылку на рисунок>**

Рисунок 12. Схемы распайки датчиков  

## III.	Схема, комплектующие и печатные платы

На текущий момент есть две актуальные схемы **WEGABOX**, их отличие в спосбе сборке и в печатной плате, первая предназначена для самостоятельной сборки на базе платы версии **4.4 fix1** и вторая для заказа на производстве на базе платы версии **5.4.2**, поговорим о них поподробнее.

**1.Плата версии 4.4 fix1** - версия платы для самостоятельной сборки, имееет компактные размеры, комплектующие подобраны таким образом, что бы их было удобно устанавливать и заказывать. Помимо основных компонентов отвчающих за подключение и работу датчиков содержит в составе силовую часть для подключения и управления помпами, клапанами, дозатором концентратов удобрений. Силовая часть построена на базе одного расширителя **MCP23017 E/SP** и четырех драйверов **SN754410NE**, что в сумме позволяет подключить одновременно до 4-х шаговых двигателей, до 8 коллекторных двигателей 12В/2А с возможностью управления направлением вращения и до 16 коллекторных двигателей 12В/2А без возможности управления направлением вращения или до 16 реле 12В/2А. На текущий момент программная часть позволяет управлять помпой циркуляции раствора гидропонной установки (подключается к контактам DRV1_A и GND) и помпой/клапаном для долива чистой воды для удержания величины EC (подключается к контактам DRV1_D и GND). Управляющие настройки задаются на Веб странице Вегабокса. Контакты DRV2_A-D и DRV3_A-D предназначены для подключения шаговых двигателей дозера концентратов удобрений, гастройка работы которых также осуществляется через Веб страницу Вегабокса. Контакты DRV1_B, DRV1_C,DRV4_A-D на текущий момент не используются и являются резервыми для развития Вегабокса в будущем. Принципиальная схема Вегабокса версии 4.4 fix1 показана на рисунке 13.

**<Вставить ссылку на рисунок>**

Рисунок 13. Принципиальная схема Вегабокс 4.4 fix1  

Для сборки Вегабокс 4.4 fix1 потребуется:
- заказать печатную плату (PCB) - заказ можно сделать на **<JLCPCB - JLCPCB.com>** (**<ссылка на архив файла GERBER для заказа платы>**) или другом удобном для вас месте, можно также поспрашивать в чате канала WEGABOX, возможно у кого то есть лишняя плата и он готов будет ею поделиться;
- заказать комплектующие (помимо датчиков) - **<список комплектующих>**;
- приобрести (одолжить, взять в аренду) инструмент - паяльник, припой, флюс, кусачки, пинцет;
- распечатать на 3D принтере (**<Ссылка на 3D модель корпуса>**) или изготовить/доработать корпус для платы.

Порядок и особенности сборки смотри в разделе **IV. Сборка**

**1.Плата версии 5.4 fix1** - версия платы для заказа сборки на производстве - jlcpcb.com, pcbway.com или аналогичных. По функционалу плата ничем не отличается от Вегабокса версии 4.4 fix1. Для размещения заказа вам потребуется файл печатной платы **<Ссылка на GERBER>** и файл компонентов **<Ссылка на BOM>**. Имейте в виду, что обычно минимальная партия для заказа 5 шт. Принципиальная схема Вегабокса версии 5.4.2 показана на рисунке 13.

**<Вставить ссылку на рисунок>**

Рисунок 14. Принципиальная схема Вегабокс 5.4.2  



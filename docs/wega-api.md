# WEGA-API

## Назначение

`WEGA-API` отвечает за получение данных от контроллеров сбора показаний сенсоров. Контроллеры подключаются к API и передают измеренные значения в базы данных.

Каждому контроллеру соответствует свой файл API, где прописаны параметры подключения к базе и ключ доступа.

## Настройка подключения к базе данных

Создаём файл доступа на основе примера и редактируем его:

```bash
cp /var/WEGA/example/wega-api/wegabox.php.example /var/WEGA/wega-api/wegabox.php
nano /var/WEGA/wega-api/wegabox.php
```

Главная задача — изменить строку с ключом доступа (`$auth`). Этот ключ будет использовать устройство при отправке данных на сервер.

> **Важно:** один ключ = один API. Несколько устройств могут использовать один API, но допускается создание отдельных API для разных устройств.

## Проверка работы (API POST)

Выполним запрос в браузере:

```
http://WEGA_SERVER_IP/wega-api/wegabox.php?auth=adab637320e5c47624cdd15169276981&db=esp32wega&RootTemp=25&AirTemp=25&AirHum=50
```

Где:

- `WEGA_SERVER_IP` — адрес сервера.
- `auth=...` — код доступа к API (задан в `/var/WEGA/wega-api/wegabox.php`).
- `db=esp32wega` — имя базы данных для записи (для каждого модуля `ESP` рекомендуется своя база).

Запрос создаст базу `sens` и внесёт тестовые показания. Затем заходим в интерфейс WEGA (`http://WEGA_SERVER_IP/wega` → **Анализ → Таблица значений**) и проверяем наличие записей с единицами.

## Конфигурация обработки сенсоров

Файлы конфигурации расположены в каталоге:

```bash
cd /var/WEGA/wegagui/config
cp example/example.conf.php esp32wega.conf.php
nano esp32wega.conf.php
```

Если модулей `WEGA-ESP32` несколько, создаём конфигурацию для каждого:

```bash
cd /var/WEGA/wegagui/config
cp example/example.conf.php mainNFT.conf.php
nano mainNFT.conf.php
```
